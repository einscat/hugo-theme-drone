{{- $.Scratch.Add "index" slice -}}
{{- range where .Site.RegularPages "Type" "posts" -}}
  {{- $date := .Date.Format "2006-01-02" -}}

  {{- /* 优化：生成纯文本内容，避免 JSON 解析 HTML 出错，并限制长度 */ -}}
  {{- $content := .Content | plainify | htmlUnescape | truncate 5000 -}}

  {{- $item := dict
    "title" .Title
    "permalink" .Permalink
    "date" $date
    "summary" (.Summary | plainify | htmlUnescape)
    "content" $content
    "tags" .Params.tags
    "categories" .Params.categories
  -}}
  {{- $.Scratch.Add "index" $item -}}
{{- end -}}
{{- $.Scratch.Get "index" | jsonify -}}